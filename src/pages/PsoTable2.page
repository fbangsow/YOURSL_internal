<apex:page showHeader="false" standardStylesheets="false" sidebar="false" name="PSOTable2" controller="PsoTable2Controller" applyHtmlTag="false" applyBodyTag="false" docType="html-5.0">
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">

        <apex:includeScript value="{!URLFOR($Resource.jQuery_2_2_0)}"/>
        <apex:includeScript value="{!URLFOR($Resource.StreamingApiScripts,'json2.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.StreamingApiScripts,'Cometd.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.StreamingApiScripts,'jquery.cometd.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.jQuery_ui_1_11_4,'jquery-ui.min.js')}"/>
        <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js" />
        <apex:includeScript value="{!URLFOR($Resource.PsoTable2,'js/core.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.PsoTable2,'js/controllers/root.js')}"/>
        <apex:includeScript value="{!URLFOR($Resource.PsoTable2,'js/controllers/staffing.js')}"/>

        <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.lightningStyle, '/assets/styles/salesforce-lightning-design-system.css')}" />
        <link rel="stylesheet" href="{!URLFOR($Resource.jQuery_ui_1_11_4,'jquery-ui.min.css')}" />
        <link rel="stylesheet" href="{!URLFOR($Resource.PsoTable2,'css/main.css')}" />

        <div data-ng-app="PsoTable2" data-ng-controller="PsoTable2" id="pso-table" ng-init="sfEndpoint.initializeBroadcastSession('{!$Api.Session_ID}')">
            <!-- loading -->
            <apex:pageBlock html-data-ng-if="status.loading">
                <div aria-hidden="false" role="dialog" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container textCenter">
                        <div class="slds-modal__menu slds-max-small-buttons--stretch slds-x-small-buttons--stacked" >
                            <div class="slds-spinner--large" >
                                <img src="{!URLFOR($Resource.lightningStyle, '/assets/images/spinners/slds_spinner_brand.gif')}" alt="loading.." />
                            </div>

                        </div>
                    </div>
                </div>
                <div class="slds-backdrop slds-backdrop--open"></div>
            </apex:pageBlock>
            <!-- loading end-->

            <apex:pageBlock >
                <div id="filter" class="headerfixed">
                    <div class="slds-page-header" role="banner">
                        <div class="slds-grid">
                            <div class="slds-media__body">
                                <div class="slds-grid">
                                    <h1 class="slds-text-heading--medium slds-m-right--small slds-truncate slds-align-middle" title="Resource Planning Tool 3.0">Resource Planning Tool 3.0</h1>
                                    <div class="slds-dropdown-trigger " >
                                        <a class="button--neutral slds-button  slds-button__icon--left" aria-haspopup="true" ng-click="viewState.filterVisible=!viewState.filterVisible">
                                            <svg class="slds-icon slds-icon--x-small slds-icon-text-default slds-icon--x-smallMagrin ">
                                                <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#filterList')}"></use>
                                            </svg>
                                        </a>

                                        <!-- show filter popup -->
                                        <div class=" filterpopup slds-nubbin--top-left" id="newpost" ng-show="viewState.filterVisible">
                                            <a class="slds-button slds-button--small slds-modal__close  slds-icon--small" ng-click="viewState.filterVisible=false">
                                                <svg aria-hidden="true" class="slds-icon slds-icon--x-small slds-icon-text-default">
                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                                </svg>
                                                <span class="slds-assistive-text">Close</span>
                                            </a>
                                            <div class=" slds-m-around--medium">
                                                <div class="slds-text-heading--label slds-m-bottom--medium">Filter</div>
                                                <dl class="slds-dl--horizontal" >
                                                    <dt class="slds-dl--horizontal__label slds-p-around--xx-small">
                                                        <!-- section 1 -->
                                                        <section id="opportunities-filter">
                                                            <div class="slds-form-element">
                                                                <section class="slds-clearfix slds-m-bottom--medium">
                                                                    <div class="slds-float--left">
                                                                        <div class="slds-tile">
                                                                            <p class="slds-text-heading--small">Select opportunities:</p>
                                                                            <div class="slds-tile__detail slds-text-body--small">
                                                                                <label class="slds-text-body--small">related opportunities: <input type="checkbox" class="checkbox" ng-model="viewState.selectRelatedOpportunities" ng-click="filter.opportunities.selectRelatedOpportunities()"/></label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-float--right"></div>
                                                                </section>

                                                                <select multiple="multiple" name="selectedOpportunities" id="selectedOpportunities" ng-model="viewState.selectedOpportunities" ng-attr-size="{{ viewState.selectedOpportunitiesSize }}" ng-disabled="viewState.selectRelatedOpportunities" class="slds-input  slds-p-around--xx-small height100" >
                                                                    <optgroup ng-repeat="customer in data.Customers | filter : filter.opportunities.customerMatchesFilter track by customer.AccountId" label="{{ ::customer.AccountName }}" ng-click="filter.opportunities.events.accountClicked(customer, $event)">
                                                                        <option ng-repeat="project in customer.Projects | filter : filter.opportunities.projectMatchesFilter track by project.OpportunityId" value="{{ ::project.OpportunityId }}">
                                                                            {{ ::project.OpportunityName }}
                                                                        </option>
                                                                    </optgroup>
                                                                </select>

                                                                <input type="search" placeholder="Filter opportunities" ng-model="viewState.opportunitiesFilterText" ng-change="filter.opportunities.removeFilteredOpportunitiesFromSelection()" class="slds-input" />

                                                                <section class="slds-clearfix slds-m-bottom--medium">
                                                                    <div class="slds-float--left">
                                                                        <p>
                                                                            <a href="#" ng-click="filter.opportunities.clearSelectedOpportunities()">
                                                                                <svg class="slds-icon slds-icon--x-small CustomColor-blue slds-m-right--x-small">
                                                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#clear')}"></use>
                                                                                </svg>
                                                                                Clear applied filters
                                                                            </a>
                                                                        </p>
                                                                    </div>
                                                                    <div class="slds-float--right">
                                                                        <p>
                                                                            <a href="#" ng-click="filter.opportunities.selectAllOpportunities()">
                                                                                <svg class="slds-icon slds-icon--x-small CustomColor-blue slds-m-right--x-small">
                                                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#filter')}"></use>
                                                                                </svg>
                                                                                Select all
                                                                            </a>
                                                                        </p>
                                                                    </div>
                                                                </section>
                                                            </div>
                                                        </section>
                                                        <!-- section 1 ende-->
                                                    </dt>
                                                    <dt class="slds-dl--horizontal__label slds-p-around--xx-small">
                                                        <!-- section 2 -->
                                                        <section id="resources-filter">
                                                            <div class="slds-form-element">
                                                                <section class="slds-clearfix slds-m-bottom--medium">
                                                                    <div class="slds-float--left">
                                                                        <div class="slds-tile">
                                                                            <p class="slds-text-heading--small">Select Resources:</p>
                                                                            <div class="slds-tile__detail slds-text-body--small">
                                                                                <label class="slds-text-body--small">related resources: <input type="checkbox" class="checkbox" ng-model="viewState.selectRelatedResources" ng-click="filter.resources.selectRelatedResources()"/></label>
                                                                                <br />
                                                                                <label class="slds-text-body--small">hide resources without budget: <input type="checkbox" class="checkbox" ng-model="viewState.hideNoBudgetResources" /></label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-float--right"></div>
                                                                </section>

                                                                <select multiple="multiple" name="selectedResources" id="selectedResources" ng-model="viewState.selectedResources" ng-attr-size="{{ viewState.selectedResourcesSize }}" ng-disabled="viewState.selectRelatedResources" class="slds-input  slds-p-around--xx-small height100" >
                                                                    <optgroup ng-repeat="role in data.Resources | filter : filter.resources.roleMatchesFilter track by role.Role" label="{{ ::role.Role }}" ng-click="filter.resources.events.roleClicked(role, $event)">
                                                                        <option ng-repeat="resource in role | filter : filter.resources.resourceMatchesFilter track by resource.ContactId" value="{{ ::resource.ContactId }}">
                                                                            {{ ::resource.ResourceName }}
                                                                        </option>
                                                                    </optgroup>
                                                                </select>

                                                                <input type="search" placeholder="Filter resources" ng-model="viewState.resourcesFilterText" ng-change="filter.resources.removeFilteredResourcesFromSelection()" class="slds-input" />

                                                                <section class="slds-clearfix slds-m-bottom--medium">
                                                                    <div class="slds-float--left">
                                                                        <p>
                                                                            <a href="#" ng-click="filter.resources.clearSelectedResources()">
                                                                                <svg class="slds-icon slds-icon--x-small CustomColor-blue slds-m-right--x-small">
                                                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#clear')}"></use>
                                                                                </svg>
                                                                                Clear applied filters
                                                                            </a>
                                                                        </p>
                                                                    </div>
                                                                    <div class="slds-float--right">
                                                                        <p>
                                                                            <a href="#" ng-click="filter.resources.selectAllResources()">
                                                                                <svg class="slds-icon slds-icon--x-small CustomColor-blue slds-m-right--x-small">
                                                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#filter')}"></use>
                                                                                </svg>
                                                                                Select all
                                                                            </a>
                                                                        </p>
                                                                    </div>
                                                                </section>
                                                            </div>
                                                        </section>
                                                        <!-- section 2 ende-->
                                                    </dt>
                                                    <dt class="slds-dl--horizontal__label">
                                                        <!-- section 3 -->
                                                        <section id="date-filter">
                                                            <div class="slds-form-element">
                                                                <section class="slds-clearfix slds-m-bottom--medium">
                                                                    <div class="slds-float--left">
                                                                        <div class="slds-tile">
                                                                            <p class="slds-text-heading--small">Select Months:</p>
                                                                            <div class="slds-tile__detail slds-text-body--small">
                                                                                <p class="slds-text-body--small">&nbsp;</p>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="slds-float--right"></div>
                                                                </section>
                                                                <div class="slds-form-element">
                                                                    <div class="calendar">
                                                                        <div class="slds-input slds-p-around--xx-small" >
                                                                            <ul >
                                                                                <li ng-click="filter.decreaseStartMonthYear()" ng-class="{disabled:!viewState.hasPreviousStartMonthYear()}">
                                                                                    <svg class="slds-icon slds-icon--x-small CustomColor-text slds-m-right--x-small">
                                                                                        <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#left')}"></use>
                                                                                    </svg>
                                                                                </li>
                                                                                <li>{{ viewState.startMonth | date : 'yyyy' }}</li>
                                                                                <li ng-click="filter.increaseStartMonthYear()" ng-class="{disabled:!viewState.hasNextStartMonthYear()}">
                                                                                    <svg class="slds-icon slds-icon--x-small CustomColor-text slds-m-right--x-small">
                                                                                        <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#right')}"></use>
                                                                                    </svg>
                                                                                </li>
                                                                                <li><hr /></li>
                                                                                <li ng-class="filter.getStartMonthClasses(1)" ng-click="filter.setStartMonthMonth(1)">Jan</li>
                                                                                <li ng-class="filter.getStartMonthClasses(2)" ng-click="filter.setStartMonthMonth(2)">Feb</li>
                                                                                <li ng-class="filter.getStartMonthClasses(3)" ng-click="filter.setStartMonthMonth(3)">Mar</li>
                                                                                <li ng-class="filter.getStartMonthClasses(4)" ng-click="filter.setStartMonthMonth(4)">Apr</li>
                                                                                <li ng-class="filter.getStartMonthClasses(5)" ng-click="filter.setStartMonthMonth(5)">May</li>
                                                                                <li ng-class="filter.getStartMonthClasses(6)" ng-click="filter.setStartMonthMonth(6)">Jun</li>
                                                                                <li ng-class="filter.getStartMonthClasses(7)" ng-click="filter.setStartMonthMonth(7)">Jul</li>
                                                                                <li ng-class="filter.getStartMonthClasses(8)" ng-click="filter.setStartMonthMonth(8)">Aug</li>
                                                                                <li ng-class="filter.getStartMonthClasses(9)" ng-click="filter.setStartMonthMonth(9)">Sep</li>
                                                                                <li ng-class="filter.getStartMonthClasses(10)" ng-click="filter.setStartMonthMonth(10)">Oct</li>
                                                                                <li ng-class="filter.getStartMonthClasses(11)" ng-click="filter.setStartMonthMonth(11)">Nov</li>
                                                                                <li ng-class="filter.getStartMonthClasses(12)" ng-click="filter.setStartMonthMonth(12)">Dec</li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <section class="slds-clearfix slds-m-bottom--medium">
                                                                    <div class="slds-float--right">
                                                                        <p>
                                                                            <a href="#" ng-click="filter.resetStartMonth()">
                                                                                <svg class="slds-icon slds-icon--x-small CustomColor-blue slds-m-right--x-small">
                                                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#weeklyview')}"></use>
                                                                                </svg>
                                                                                Current date
                                                                            </a>
                                                                        </p>
                                                                    </div>
                                                                </section>
                                                            </div>
                                                        </section>
                                                        <!-- section 3 ende-->
                                                    </dt>
                                                </dl>
                                                <div class="center">
                                                    <button  ng-click="filter.events.updateStaffingClicked($event)" class="slds-button slds-button--brand slds-m-around--xxx-small">Update staffing view</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-m-bottom--large"></div>
                                        <!-- filter popup ende -->
                                    </div>
                                </div>

                                <p class="slds-text-heading--label">{{ viewState.startMonth | date : 'MMM yyyy' }} - {{ viewState.endMonth | date : 'MMM yyyy' }}</p>
                            </div>

                            <!-- run scheduler popup -->
                            <div class="schedulerpopup slds-nubbin--top-right" id="scheduler" ng-show="viewState.schedulerVisible" ng-if="viewState.isAllowedToRunScheduler">
                                <a class="slds-button slds-button--small slds-modal__close slds-icon--small " ng-click="viewState.schedulerVisible=false">
                                    <svg aria-hidden="true" class="slds-icon slds-icon--x-small slds-icon-text-default closeButton">
                                        <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </a>

                                <div class="slds-m-around--medium">
                                    <div class="slds-text-heading--label slds-m-bottom--medium">Rerun PSO statistics aggregation</div>
                                    Please select the week / month to run the aggregation for.
                                    <div data-show-week-or-month-picker="viewState.schedulerVisible" data-select-date="prepareSchedulerRun(selectedDate)">
                                    </div>
                                </div>
                            </div>
                            <!-- run scheduler popup end -->

                            <!-- show legend popup -->
                            <div class="legendpopup slds-nubbin--top-right" id="legend" ng-show="viewState.legendVisible">
                                <a class="slds-button slds-button--small slds-modal__close slds-icon--small posIcon" ng-click="viewState.legendVisible=false">
                                    <svg aria-hidden="true" class="slds-icon slds-icon--x-small slds-icon-text-default">
                                        <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                    </svg>
                                </a>

                                <div class="slds-m-around--medium legends">
                                    <div class="slds-text-heading--label slds-m-bottom--medium">Legend</div>
                                    <ul class="slds-list--vertical slds-has-dividers--top">
                                        <li class="slds-list__item"><b>Booking Status</b></li>
                                        <li class="slds-list__item"><span class="partly-staffed"></span> Partly booked</li>
                                        <li class="slds-list__item"><span class="fully-staffed"></span> Fully booked</li>
                                        <li class="slds-list__item"><span class="overstaffed"></span> Overbooked</li>
                                        <li class="slds-list__item"><span class="has-staffing-and-holiday"></span>Has staffing and holiday</li>
                                        <li class="slds-list__item"><span class="full-holiday"></span>Full holiday</li>
                                        <li class="slds-list__item"><b>Saldo Status</b></li>
                                        <li class="slds-list__item"><span class="neutral-saldo"></span> Neutral saldo</li>
                                        <li class="slds-list__item"><span class="positive-saldo"></span> Positive saldo</li>
                                        <li class="slds-list__item"><span class="negative-saldo"></span> Negative saldo</li>
                                        <li class="slds-list__item"><b>Utilization Status</b></li>
                                        <li class="slds-list__item"><span class="high-utilization"></span> Higher or equal 80%</li>
                                        <li class="slds-list__item"><span class="neutral-utilization"></span>Between 60% &amp; 80%</li>
                                        <li class="slds-list__item"><span class="low-utilization"></span> Between 40% &amp; 60%</li>
                                        <li class="slds-list__item"><span class="very-low-utilization"></span> Less 40%</li>
                                    </ul>
                                </div>
                            </div>
                            <!-- show legend popup ende -->

                            <!-- header navigation -->
                            <div class="slds-col slds-no-flex ">
                                <div class="slds-button-group" role="group">
                                    <span id="connection-status" class="slds-button slds-button--neutral tooltip" data-tooltip="Outside resource allocation changes are{{ viewState.isConnected ? ' ' : ' currently not ' }}synchronized">
                                        <svg class="slds-icon slds-icon--x-small slds-icon-text-default" ng-show="viewState.isConnected">
                                            <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#success')}"></use>
                                        </svg>
                                        <svg class="slds-icon slds-icon--x-small slds-icon-text-default" ng-hide="viewState.isConnected">
                                            <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#offline')}"></use>
                                        </svg>
                                    </span>
                                    <a class="slds-button slds-button--neutral" href="#" ng-click="viewState.legendVisible=!viewState.legendVisible">
                                        <svg class="slds-icon slds-icon--x-small slds-icon-text-default ">
                                            <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#question')}"></use>
                                        </svg>
                                    </a>
                                    <a class="slds-button slds-button--neutral"  aria-haspopup="true" ng-click="viewState.schedulerVisible=!viewState.schedulerVisible" ng-if="viewState.isAllowedToRunScheduler">
                                        <svg class="slds-icon slds-icon--x-small slds-icon-text-default ">
                                            <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#clock')}"></use>
                                        </svg>
                                    </a>
                                    <div class="slds-button--last">
                                        <a class="slds-button slds-button--icon-border-filled" href="/home/home.jsp">
                                            <svg class="slds-icon slds-icon--x-small slds-icon-text-default ">
                                                <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#home')}"></use>
                                            </svg>
                                            <span class="slds-assistive-text">More</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <!-- header navigation end -->
                        </div>
                    </div>
                </div>
            </apex:pageBlock>

            <apex:pageBlock html-data-ng-show="status.loaded" html-ng-controller="PsoTable2Staffing">
                <section id="staffing" class="contentBox slds-m-around--medium slds-box slds-scrollable--y">
                    <div id="captions">
                        <table class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal slds-text-heading--label">
                            <tbody>
                                <tr class="tableheader">
                                    <th colspan="5" class="tableheaderBorder">&nbsp;</th>
                                </tr>
                                <tr class="tableheader">
                                    <th colspan="5" class="tableheaderBorder">&nbsp;</th>
                                </tr>
                                <tr class="tableheader">
                                    <th colspan="5">&nbsp;</th>
                                </tr>
                                <tr class="tableheader">
                                    <th class="padding10left" ng-click="staffing.orderProjectResourcesBy('ResourceName')" ng-class="{'sort-asc':viewState.orderProjectResources==='ResourceName' && !viewState.orderProjectResourcesDescending, 'sort-desc':viewState.orderProjectResources==='ResourceName' && viewState.orderProjectResourcesDescending}">Resource</th>
                                    <th ng-click="staffing.orderProjectResourcesBy('Role')" ng-class="{'sort-asc':viewState.orderProjectResources==='Role' && !viewState.orderProjectResourcesDescending, 'sort-desc':viewState.orderProjectResources==='Role' && viewState.orderProjectResourcesDescending}">Role</th>
                                    <th ng-click="staffing.orderProjectResourcesBy('SoldDays')" ng-class="{'sort-asc':viewState.orderProjectResources==='SoldDays' && !viewState.orderProjectResourcesDescending, 'sort-desc':viewState.orderProjectResources==='SoldDays' && viewState.orderProjectResourcesDescending}" data-tooltip="Sold days">SD</th>
                                    <th ng-click="staffing.orderProjectResourcesBy('PlannedDays')" ng-class="{'sort-asc':viewState.orderProjectResources==='PlannedDays' && !viewState.orderProjectResourcesDescending, 'sort-desc':viewState.orderProjectResources==='PlannedDays' && viewState.orderProjectResourcesDescending}" data-tooltip="Planned days">PD</th>
                                    <th ng-click="staffing.orderProjectResourcesBy('UnplannedDays')" ng-class="{'sort-asc':viewState.orderProjectResources==='UnplannedDays' && !viewState.orderProjectResourcesDescending, 'sort-desc':viewState.orderProjectResources==='UnplannedDays' && viewState.orderProjectResourcesDescending}" data-tooltip="Unplanned days">UD</th>
                                </tr>
                            </tbody>
                            <tbody data-ng-if="data.Customers.length" ng-repeat="customer in data.Customers track by customer.AccountId">
                                <tr ng-repeat-start="project in customer.Projects track by project.OpportunityId" class="project-info slds-text-body--small" >
                                    <td colspan="5"  class="tdslds-text-body--smal">
                                        <span class="slds-icon__container slds-float--left">
                                            <a class="slds-button__icon slds-button__icon--left" href="/apex/OpportunityLineItemsEdit?id={{ ::project.OpportunityId }}" target="blank">
                                                <svg class="slds-icon slds-icon--x-small slds-icon-text-default ">
                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#cases')}"></use>
                                                </svg>
                                            </a>
                                            <!-- ProjectStatus popup disabled until further -->
                                            <!--
                                            <a class="slds-button__icon slds-button__icon--left" ng-click="ProjectStatusVisible=!ProjectStatusVisible" title="Sales Price And Quantity">
                                                <svg class=" slds-icon--x-small slds-icon-text-default ">
                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#settings')}"></use>
                                                </svg>
                                            </a>
                                            -->
                                        </span>
                                        <h4>
                                            <b><a href="/{{ ::customer.AccountId }}" target="_blank">{{ ::customer.AccountName }}</a></b>
                                            &nbsp;&gt;&nbsp;
                                            <a href="/{{ ::project.OpportunityId }}" target="_blank">{{ ::project.OpportunityName }}</a>
                                            <span ng-if="project.ProjectManagerId">
                                                (<a href="/{{ ::project.ProjectManagerId}}" target="_blank">{{ ::project.OurProjectManager }}</a>)
                                            </span>
                                        </h4>

                                        <!-- show ProjectStatus popup, disabled until further -->
                                        <!--
                                        <div class="ProjectStatusVisiblepopup slds-nubbin--left-top" ng-show="ProjectStatusVisible">
                                            <a class="slds-button slds-button--small slds-modal__close slds-icon--small" style="margin-top: 41px;" ng-click="ProjectStatusVisible=false">
                                                <svg aria-hidden="true" class="slds-icon slds-icon--x-small slds-icon-text-default">
                                                    <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                                </svg>
                                            </a>
                                            <div class="slds-m-around--medium">
                                                <div class="slds-text-heading--label slds-m-bottom--medium">Project Status</div>
                                                <ul class="slds-list--vertical slds-has-dividers--top slds-has-list-interactions">
                                                    <li class="slds-list__item slds-p-left--small" ng-repeat="(label, reason) in viewState.projectHealthReasons" ng-click="project.ProjectStatus=reason;updateProjectStatus(project)" >{{ label }} </li>
                                                </ul>
                                            </div>
                                        </div>
                                        -->
                                        <!-- show ProjectStatus popup ende -->
                                    </td>
                                </tr>
                                <tr><td colspan="5" class="shadow"></td></tr>
                                <tr ng-repeat="resource in project.Resources | filter : viewState.filterProjectResource | orderBy : viewState.orderProjectResources : viewState.orderProjectResourcesDescending" ng-class="buildResourceRowClasses(resource)" class="slds-text-body--small">
                                    <td class="fixtd">
                                        <a href="/{{ ::resource.ContactId }}" target="_blank">{{ ::resource.ResourceName }}</a>
                                    </td>
                                    <td class="fixtd">
                                        {{ ::resource.Product }}
                                    </td>
                                    <td class="fixtd">
                                        {{ (resource.SoldDays / 8) | number : 2 }}
                                    </td>
                                    <td class="fixtd">
                                        {{ (resource.PlannedDays / 8) | number : 2 }}
                                    </td>
                                    <td class="fixtd">
                                        {{ (resource.UnplannedDays / 8) | number : 2 }}
                                    </td>
                                </tr>
                                <tr ng-repeat-end="true" class="slds-text-body--small sum-up">
                                    <td colspan="2" class="fixtd">
                                        Total
                                    </td>
                                    <td class="fixtd">
                                        {{ (project.SoldDays / 8) | number : 2 }}
                                    </td>
                                    <td class="fixtd">
                                        {{ (project.PlannedDays / 8) | number : 2 }}
                                    </td>
                                    <td class="fixtd">
                                        {{ ((project.SoldDays - project.PlannedDays) / 8) | number : 2 }}
                                    </td>
                                </tr>
                            </tbody>
                            <tbody class="Resources" ng-if="data.Resources.length && ($parent.viewState.selectRelatedResources || $parent.viewState.selectedResources.length)">
                                <tr class="tableheader">
                                    <th colspan="5" class="firsttableheader">
                                        <h4>Resource availability</h4>
                                    </th>
                                </tr>
                                <tr class="tableheader">
                                    <th ng-click="staffing.orderResourcesBy('ResourceName')" ng-class="{'sort-asc':viewState.orderResources==='ResourceName' && !viewState.orderResourcesDescending, 'sort-desc':viewState.orderResources==='ResourceName' && viewState.orderResourcesDescending}">
                                        Resource name
                                    </th>
                                    <th ng-click="staffing.orderResourcesBy('Title')" ng-class="{'sort-asc':viewState.orderResources==='Title' && !viewState.orderResourcesDescending, 'sort-desc':viewState.orderResources==='Title' && viewState.orderResourcesDescending}">
                                        Title
                                    </th>
                                    <th colspan="3" class="firsttableheader" ng-click="staffing.orderResourcesBy('AccountName')" ng-class="{'sort-asc':viewState.orderResources==='AccountName' && !viewState.orderResourcesDescending, 'sort-desc':viewState.orderResources==='AccountName' && viewState.orderResourcesDescending}">
                                        Account name
                                    </th>
                                </tr>
                                <tr ng-repeat="resource in data.Resources | orderBy : viewState.orderResources : viewState.orderResourcesDescending track by resource.ContactId" ng-class="buildResourceRowClasses(resource)">
                                    <td class="padding10left">{{ ::resource.ResourceName }}</td>
                                    <td>{{ ::resource.Title }}</td>
                                    <td colspan="3" style="border-right:1px solid #ffffff !important;">{{ ::resource.AccountName}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id="schedule" data-staffing-captions-spacing="#captions">
                        <table class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal slds-text-heading--label" data-navigate-cell-inputs="true">
                            <tbody>
                                <tr class="tableheader">
                                    <th colspan="{{ ::month.dayCount }}" ng-repeat="month in viewState.staffingMonths track by month.number">
                                        {{ ::month.caption }}
                                    </th>
                                </tr>
                                <tr class="tableheader">
                                    <th colspan="{{ ::week.dayCount }}" ng-repeat="week in viewState.staffingWeeks track by week.number" class="padding10left">
                                        CW-{{ ::week.number }}
                                    </th>
                                </tr>
                                <tr class="tableheader">
                                    <th ng-repeat="day in viewState.staffingDays track by day.dateString" ng-class="buildDayHeaderClasses(day)" rowspan="{{ ::day.isSaldo ? 2 : 1 }}" class="textCenter col">
                                        <div class="weekDay" ng-attr-data-tooltip="{{ ::day.tooltip }}">
                                            {{ ::day.weekDay }}
                                        </div>
                                    </th>
                                </tr>
                                <tr class="tableheader">
                                    <th ng-repeat="day in viewState.staffingDays track by day.dateString" ng-class="buildDayHeaderClasses(day)" ng-if="!day.isSaldo" class="textCenter">
                                        {{ ::day.day }}
                                    </th>
                                </tr>
                            </tbody>
                            <tbody data-ng-if="data.Customers.length" ng-repeat="customer in data.Customers track by customer.AccountId">
                                <tr ng-repeat-start="project in customer.Projects track by project.OpportunityId" class="project-info slds-text-body--small" style="height:30px;">
                                    <td colspan="{{ viewState.staffingColumns }}">
                                        &nbsp;
                                    </td>
                                </tr>
                                <tr><td colspan="{{ viewState.staffingColumns }}" class="shadow"></td></tr>
                                <tr ng-repeat="resource in project.Resources | filter : viewState.filterProjectResource | orderBy : viewState.orderProjectResources : viewState.orderProjectResourcesDescending" ng-class="buildResourceRowClasses(resource)" class="slds-text-body--small schedule">
                                    <td ng-repeat="day in viewState.staffingDays track by day.dateString" ng-class="buildResourceAllocationCellClasses(resource, day, resource.StaffingByDay[day.dateString])" class="textCenter">
                                        <span ng-if="day.isMonthSaldo">
                                            {{ ((resource.Saldos[day.dateString] || 0) / 8) | number : 2 }}
                                        </span>

                                        <span ng-if="day.isUtilization" data-tooltip="{{ ((resource.Saldos[day.dateString].booked || 0) / 8) | number : 2 }} / {{ ((resource.Saldos[day.dateString].budget || 0) / 8) | number : 2 }}" class="tooltip">
                                            {{ ((resource.Saldos[day.dateString].value || 0) * 100) | number : 1 }}%
                                        </span>

                                        <span ng-if="day.isStatisticSaldo">
                                            {{ (resource.Saldos[day.dateString].actual || 0) | number : 2 }} / {{ (resource.Saldos[day.dateString].planned || 0) | number : 2 }}
                                        </span>

                                        <span ng-if="resource.StaffingByDay[day.dateString] !== undefined && resource.StaffingByDay[day.dateString].Staff > 0 && (!day.isAllocatable || !resource.MonthToLimitMap[day.month] || data.ResourcesByContactId[resource.ContactId].StaffingByDay[day.dateString].isFullHoliday)">
                                            {{ resource.StaffingByDay[day.dateString].Staff }}
                                        </span>

                                        <input ng-if="day.isAllocatable && resource.MonthToLimitMap[day.month] && !data.ResourcesByContactId[resource.ContactId].StaffingByDay[day.dateString].isFullHoliday" ng-model="resource.StaffingByDay[day.dateString].currentBooking" ng-blur="staffing.updateAllocation(project, resource, day.date, resource.StaffingByDay[day.dateString])" ng-change="staffing.scheduleAsyncAllocationUpdate(project, resource, day.date, resource.StaffingByDay[day.dateString])" />

                                        <span ng-if="day.isAllocatable && resource.StaffingByDay[day.dateString].Staff > 0 && data.ResourcesByContactId[resource.ContactId].StaffingByDay[day.dateString].isFullHoliday" class="tooltip ResourceInfo" data-tooltip="Remove project allocation" style="bottom: auto; top: 0;" ng-click="staffing.clearAllocation(project, resource, day.date, resource.StaffingByDay[day.dateString])">
                                            <svg class="slds-icon slds-icon--x-small slds-icon-text-default">
                                                <use xlink:href="{!URLFOR($Resource.lightningStyle, '/assets/icons/utility-sprite/svg/symbols.svg#delete')}"></use>
                                            </svg>
                                        </span>

                                        <span ng-if="day.isAllocatable && !resource.MonthToLimitMap[day.month]" class="tooltip ResourceInfo" data-tooltip="No budget available for {{ ::resource.ResourceName }} in this month.">
                                            <svg class="slds-icon slds-icon--x-small slds-icon-text-default">
                                                <use xlink:href="{!URLFOR($Resource.PsoTable2,'svg/icons.svg#no-budget')}"></use>
                                            </svg>
                                        </span>

                                        <span ng-if="day.isAllocatable && resource.MonthToLimitMap[day.month] && data.ResourcesByContactId[resource.ContactId].StaffingByDay[day.dateString].isFullHoliday" class="tooltip ResourceInfo" data-tooltip="{{ ::resource.ResourceName }} has holiday on this day.">
                                            <svg class="slds-icon slds-icon--x-small slds-icon-text-default">
                                                <use xlink:href="{!URLFOR($Resource.PsoTable2, 'svg/icons.svg#holiday')}"></use>
                                            </svg>
                                        </span>

                                        <!--<span ng-if="data.ResourcesByContactId[resource.ContactId].StaffingByDay[day.dateString].hasHoliday" class="holiday-info">
                                            ({{ data.ResourcesByContactId[resource.ContactId].StaffingByDay[day.dateString].HoursOff }})
                                        </span>-->
                                    </td>
                                </tr>
                                <tr ng-repeat-end="true" class="slds-text-body--small sum-up" style="border-top:2px solid #ccc">
                                    <td ng-repeat="day in viewState.staffingDays track by day.dateString" ng-class="buildProjectDayCellClasses(project, day)" class="textCenter">
                                        <span ng-if="day.isMonthSaldo">
                                            {{ ((project.Saldos[day.dateString] || 0) / 8) | number : 2 }}
                                        </span>

                                        <span ng-if="day.isUtilization" data-tooltip="{{ ((project.Saldos[day.dateString].booked || 0) / 8) | number : 2 }} / {{ (project.Saldos[day.dateString].budget / 8) | number : 2 }}" class="tooltip">
                                            {{ ((project.Saldos[day.dateString].value || 0) * 100) | number : 1 }}%
                                        </span>

                                        <span ng-if="day.isStatisticSaldo">
                                            {{ (project.Saldos[day.dateString].actual || 0) | number : 2 }} / {{ (project.Saldos[day.dateString].planned || 0) | number : 2 }}
                                        </span>

                                        <span ng-if="!day.isSaldo">
                                            {{ project.BookedHoursByDay[day.dateString] || 0 }}
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                            <tbody class="Resources" ng-if="data.Resources.length && ($parent.viewState.selectRelatedResources || $parent.viewState.selectedResources.length)">
                                <tr class="tableheader">
                                    <th colspan="{{ viewState.staffingColumns }}">
                                        <!-- Resource availability -->
                                        &nbsp;
                                    </th>
                                </tr>
                                <tr class="tableheader">
                                    <th colspan="{{ viewState.staffingColumns }}">
                                        <!-- Column captions -->
                                        &nbsp;
                                    </th>
                                </tr>
                                <tr ng-repeat="resource in data.Resources | orderBy : viewState.orderResources : viewState.orderResourcesDescending track by resource.ContactId" ng-class="buildResourceRowClasses(resource)">
                                    <td ng-repeat="day in viewState.staffingDays track by day.dateString" ng-class="buildResourceAllocationCellClasses(resource, day, resource.StaffingByDay[day.dateString])" class="textCenter">
                                        <span ng-if="day.isMonthSaldo">
                                            {{ ((resource.Saldos[day.dateString] || 0) / 8) | number : 2 }}
                                        </span>

                                        <span ng-if="day.isUtilization" data-tooltip="{{ ((resource.Saldos[day.dateString].booked || 0) / 8) | number : 2 }} / ({{ (resource.Saldos[day.dateString].budget / 8) | number : 2 }} - {{ (resource.Saldos[day.dateString].holiday / 8) | number : 2 }})" class="tooltip">
                                            {{ ((resource.Saldos[day.dateString].value || 0) * 100) | number : 1 }}%
                                        </span>

                                        <span ng-if="day.isStatisticSaldo">
                                            {{ (resource.Saldos[day.dateString].actual || 0) | number : 2 }} / {{ (resource.Saldos[day.dateString].planned || 0) | number : 2 }}
                                        </span>

                                        <span ng-if="!day.isSaldo">
                                            {{ resource.StaffingByDay[day.dateString].total || 0 }}
                                        </span>

                                        <span ng-if="!day.isSaldo && resource.StaffingByDay[day.dateString].hasHoliday" class="tooltip ResourceInfo" data-tooltip="{{ resource.ResourceName }} has {{ resource.StaffingByDay[day.dateString].isPartlyHoliday ? resource.StaffingByDay[day.dateString].HoursOff + ' hours off' : 'holiday' }} on this day.">
                                            <svg class="slds-icon slds-icon--x-small slds-icon-text-default">
                                                <use xlink:href="{!URLFOR($Resource.PsoTable2, 'svg/icons.svg#holiday')}"></use>
                                            </svg>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </apex:pageBlock>

<!-- alertMessage
<div class="alert-dialog">
<div aria-hidden="false" role="dialog" class="slds-modal slds-modal--prompt slds-fade-in-open">
<div class="slds-modal__container slds-modal--prompt">
<div class="slds-modal__header slds-theme--error slds-theme--alert-texture">
<h2 class="slds-text-heading--medium">Service Unavailable</h2>
<button class="slds-button slds-button--icon-inverse slds-modal__close">
<svg aria-hidden="true" class="slds-button__icon slds-button__icon--large">
<use xlink:href="/assets/icons/action-sprite/svg/symbols.svg#close"></use>
</svg>
<span class="slds-assistive-text">Close</span>
</button>
</div>
<div class="slds-modal__content">
<div>
<p> {{ alertMessage }}</p>
</div>
</div>
<div class="slds-modal__footer slds-theme--default">
<div class="slds-x-small-buttons--horizontal">
<button class="slds-button slds-button--neutral">Okay</button>
</div>
</div>
</div>
</div>
<div class="slds-backdrop slds-backdrop--open"></div>
</div>
-->

            <!-- show error message popup -->
            <div class="alert-dialog">
                <p>
                    <span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
                    {{ alertMessage }}
                </p>
            </div>
            <!-- show error message popup end -->
        </div>
    </html>
</apex:page>